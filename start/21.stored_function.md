Perfect! Let’s go **step by step** and cover **Stored Functions in PostgreSQL**, with examples, and then compare **Procedures vs Functions**.

---

# **1. What is a Stored Function?**

* A **stored function** is a set of SQL statements stored in the database that **returns a value**.
* Unlike a procedure, a function **must return something** (`RETURNS` clause).
* Can be used in **queries, SELECT, WHERE, expressions**, etc.

---

# **2. Syntax of a Stored Function**

```sql
CREATE FUNCTION function_name(parameters)
RETURNS return_type
LANGUAGE plpgsql
AS $$
BEGIN
    -- SQL statements
    RETURN value;
END;
$$;
```

* `return_type` → data type returned (INT, NUMERIC, TEXT, etc.)
* `RETURN` → must return a value of the specified type

---

# **3. Example 1: Function to get employee salary**

**Table: employees**

| emp\_id | emp\_name | salary |
| ------- | --------- | ------ |
| 1       | Alice     | 5000   |
| 2       | Bob       | 6000   |

**Function:**

```sql
CREATE FUNCTION get_salary(p_emp_id INT)
RETURNS NUMERIC
LANGUAGE plpgsql
AS $$
DECLARE
    emp_salary NUMERIC;
BEGIN
    SELECT salary INTO emp_salary
    FROM employees
    WHERE emp_id = p_emp_id;
    
    RETURN emp_salary;
END;
$$;
```

---

# **4. Calling the Function**

```sql
-- In SELECT
SELECT get_salary(1) AS salary;
```

**Output:**

| salary |
| ------ |
| 5000   |

✅ The function returned a value that can be used in queries.

---

# **5. Example 2: Function to calculate bonus**

```sql
CREATE FUNCTION calculate_bonus(p_salary NUMERIC)
RETURNS NUMERIC
LANGUAGE plpgsql
AS $$
BEGIN
    RETURN p_salary * 0.1;
END;
$$;

-- Call it
SELECT calculate_bonus(5000) AS bonus;
```

**Output:**

| bonus |
| ----- |
| 500   |

---

# **6. Key Features of Functions**

| Feature                                              | Description                                             |
| ---------------------------------------------------- | ------------------------------------------------------- |
| Must return a value                                  | Using `RETURN`                                          |
| Can be used in queries                               | `SELECT my_function(...)`                               |
| Can have IN, OUT, INOUT                              | Optional                                                |
| Cannot perform transaction control (COMMIT/ROLLBACK) | Functions cannot manage transactions, unlike procedures |
| Can return scalar or table                           | Scalar: NUMERIC, TEXT; Table: `RETURNS TABLE(...)`      |

---

# **7. Difference Between Procedure and Function**

| Feature             | Procedure (CREATE PROCEDURE)              | Function (CREATE FUNCTION)           |
| ------------------- | ----------------------------------------- | ------------------------------------ |
| Return Value        | No direct return (can use OUT parameters) | Must return a value (RETURNS clause) |
| Usage               | CALL procedure\_name(...)                 | SELECT function\_name(...)           |
| Transaction Control | Can use COMMIT/ROLLBACK                   | Cannot use COMMIT/ROLLBACK           |
| Can be in Query     | ❌                                         | ✅ (can be used in SELECT, WHERE)     |
| OUT Parameters      | Optional                                  | Optional, but usually RETURNS value  |
| Purpose             | Perform action / modify data              | Compute value / return result        |

---

# **8. Example: Function Returning a Table**

```sql
CREATE FUNCTION get_hr_employees()
RETURNS TABLE(emp_id INT, emp_name TEXT, salary NUMERIC)
LANGUAGE plpgsql
AS $$
BEGIN
    RETURN QUERY
    SELECT emp_id, emp_name, salary
    FROM employees
    WHERE emp_id = 1; -- Assume HR dept
END;
$$;

-- Call it
SELECT * FROM get_hr_employees();
```

**Output:**

| emp\_id | emp\_name | salary |
| ------- | --------- | ------ |
| 1       | Alice     | 5000   |

✅ Functions can return **scalars or tables**.

---

If you want, I can make a **diagram showing Procedure vs Function flow** — input, output, and usage in queries — so it’s visually easy to remember.

Do you want me to do that?
