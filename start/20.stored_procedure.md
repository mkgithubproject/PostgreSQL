Perfect! Let’s dive into **Stored Procedures in PostgreSQL** with clear examples, inputs, and outputs.

---

# **1. What is a Stored Procedure?**

* A **stored procedure** is a **predefined set of SQL statements** stored in the database.
* It can **perform operations** like `INSERT`, `UPDATE`, `DELETE`, `SELECT`, etc.
* Advantages:

  1. Reusability
  2. Security (restrict direct access to tables)
  3. Performance (runs on server, reduces client-server communication)

> In PostgreSQL, **procedures** were introduced in **version 11**. Before that, functions were used similarly.

---

# **2. Syntax**

```sql
CREATE PROCEDURE procedure_name(parameters)
LANGUAGE plpgsql
AS $$
BEGIN
    -- SQL statements
END;
$$;
```

* `LANGUAGE plpgsql` → indicates we are using PostgreSQL’s procedural language.
* Parameters can be `IN`, `OUT`, or `INOUT`.

---

# **3. Example 1: Simple Procedure**

**Goal:** Insert a new employee into the `employees` table.

```sql
CREATE TABLE employees (
    emp_id SERIAL PRIMARY KEY,
    emp_name TEXT,
    dept_id INT,
    salary NUMERIC
);
```

**Stored Procedure:**

```sql
CREATE PROCEDURE add_employee(
    IN p_name TEXT,
    IN p_dept INT,
    IN p_salary NUMERIC
)
LANGUAGE plpgsql
AS $$
BEGIN
    INSERT INTO employees(emp_name, dept_id, salary)
    VALUES (p_name, p_dept, p_salary);
END;
$$;
```

---

# **4. Calling the Procedure**

```sql
CALL add_employee('Alice', 1, 5000);
CALL add_employee('Bob', 2, 6000);
```

**Check the table:**

```sql
SELECT * FROM employees;
```

**Output:**

| emp\_id | emp\_name | dept\_id | salary |
| ------- | --------- | -------- | ------ |
| 1       | Alice     | 1        | 5000   |
| 2       | Bob       | 2        | 6000   |

✅ Procedure inserted rows successfully.

---

# **5. Example 2: Procedure with UPDATE**

**Goal:** Give a salary raise to an employee.

```sql
CREATE PROCEDURE raise_salary(
    IN p_emp_id INT,
    IN p_amount NUMERIC
)
LANGUAGE plpgsql
AS $$
BEGIN
    UPDATE employees
    SET salary = salary + p_amount
    WHERE emp_id = p_emp_id;
END;
$$;
```

**Call the procedure:**

```sql
CALL raise_salary(1, 500);  -- Alice gets 500 raise
```

**Check table:**

| emp\_id | emp\_name | dept\_id | salary |
| ------- | --------- | -------- | ------ |
| 1       | Alice     | 1        | 5500   |
| 2       | Bob       | 2        | 6000   |

---

# **6. Procedure with OUT Parameter**

**Goal:** Get the salary of an employee.

```sql
CREATE PROCEDURE get_salary(
    IN p_emp_id INT,
    OUT p_salary NUMERIC
)
LANGUAGE plpgsql
AS $$
BEGIN
    SELECT salary INTO p_salary
    FROM employees
    WHERE emp_id = p_emp_id;
END;
$$;
```

**Call the procedure:**

```sql
CALL get_salary(1, p_salary);
-- p_salary will return 5500
```

---

# **7. Key Notes**

| Feature                  | Description                                                                               |
| ------------------------ | ----------------------------------------------------------------------------------------- |
| Language                 | Usually `plpgsql`                                                                         |
| Parameters               | `IN` (input), `OUT` (output), `INOUT` (both)                                              |
| Call                     | `CALL procedure_name(params)`                                                             |
| Difference from Function | Procedure cannot be used in `SELECT`, but can perform transactions (`COMMIT`, `ROLLBACK`) |
| Transactions             | Procedures can use `COMMIT`/`ROLLBACK`; functions cannot                                  |

---

# ✅ **Summary**

* Stored procedures = precompiled SQL code for reusability and modularity
* Can insert, update, delete, select, or perform logic
* Use `CALL` to execute
* Supports input and output parameters

---

Perfect! Let’s clarify **what `IN` means in a PostgreSQL procedure**.

---

# **1. `IN` Parameter in a Procedure**

* `IN` is a **parameter mode** used when **passing input values to a stored procedure**.
* It allows you to **send data into the procedure** for it to use.
* By default, **all parameters are `IN`** if you don’t specify a mode.

---

# **2. Syntax**

```sql
CREATE PROCEDURE procedure_name(IN parameter_name data_type)
LANGUAGE plpgsql
AS $$
BEGIN
    -- Use the parameter inside SQL statements
END;
$$;
```

* `parameter_name` → name of the input variable
* `data_type` → type of data it accepts (INT, TEXT, NUMERIC, etc.)

---

# **3. Example**

**Table: employees**

| emp\_id | emp\_name | dept\_id | salary |
| ------- | --------- | -------- | ------ |
| 1       | Alice     | 1        | 5000   |

**Procedure with `IN` parameters:**

```sql
CREATE PROCEDURE add_employee(
    IN p_name TEXT,
    IN p_dept INT,
    IN p_salary NUMERIC
)
LANGUAGE plpgsql
AS $$
BEGIN
    INSERT INTO employees(emp_name, dept_id, salary)
    VALUES (p_name, p_dept, p_salary);
END;
$$;
```

**Call the procedure:**

```sql
CALL add_employee('Bob', 2, 6000);
```

* `p_name` = 'Bob' → input passed to procedure
* `p_dept` = 2 → input
* `p_salary` = 6000 → input

**Output (employees table):**

| emp\_id | emp\_name | dept\_id | salary |
| ------- | --------- | -------- | ------ |
| 1       | Alice     | 1        | 5000   |
| 2       | Bob       | 2        | 6000   |

✅ The procedure **used the IN parameters to insert data**.

---

# **4. Key Points About `IN`**

| Feature | Explanation                                                                     |
| ------- | ------------------------------------------------------------------------------- |
| Purpose | To **pass input values** into a procedure                                       |
| Default | If you don’t specify `IN`, parameters are treated as IN by default              |
| Scope   | Only **readable inside the procedure**, cannot be modified to affect the caller |

---

# **5. Difference Between IN, OUT, INOUT**

| Mode  | Description                                                       |
| ----- | ----------------------------------------------------------------- |
| IN    | Input only, passes values **into** procedure                      |
| OUT   | Output only, returns values **from** procedure                    |
| INOUT | Input + Output, can pass a value in **and return modified value** |

---

If you want, I can make a **diagram showing IN, OUT, and INOUT in procedures** with a real example showing **input → procedure → output**.

Do you want me to do that?

